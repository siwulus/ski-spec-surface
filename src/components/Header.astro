---
import Navigation from '@/components/Navigation';
import { UserMenu } from '@/components/auth/UserMenu';
import { Button } from '@/components/ui/button';
import type { User } from '@supabase/supabase-js';

interface Props {
  currentPath: string;
  /** User session data from middleware */
  user?: User | null;
}

const { currentPath, user } = Astro.props;
const isAuthenticated = !!user;
---

<header
  class="sticky top-0 z-50 w-full border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"
  data-testid="header"
>
  <div class="container mx-auto flex h-16 max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8">
    <div class="flex items-center gap-6">
      <a
        href="/"
        class="flex items-center gap-2 rounded-sm transition-opacity hover:opacity-80 focus-visible:outline-none focus-visible:ring-[3px] focus-visible:ring-ring/50"
        aria-label="Ski Surface Spec - Home"
        data-testid="home-link"
      >
        <img src="/ski-surface-logo.svg" alt="" class="h-8 w-auto" aria-hidden="true" />
        <span class="sr-only">Ski Surface Spec</span>
      </a>
      <nav aria-label="Main navigation">
        <Navigation currentPath={currentPath} client:load />
      </nav>
    </div>

    <!-- Auth section -->
    <div class="flex items-center gap-3">
      {
        isAuthenticated ? (
          // <!-- Show user menu for authenticated users -->
          <UserMenu userEmail={user.email} client:load />
        ) : (
          // <!-- Show login/register buttons for guests -->
          <div class="flex items-center gap-2">
            <Button variant="default" size="sm" asChild>
              <a href="/auth/login">Log in</a>
            </Button>
            <Button variant="secondary" size="sm" asChild>
              <a href="/auth/register">Sign up</a>
            </Button>
          </div>
        )
      }
    </div>
  </div>
</header>
